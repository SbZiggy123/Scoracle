{% extends "base.html" %}

{% block main_content %}
<script src="{{ url_for('static', filename='prediction.js') }}"></script>
<div class="grid-container">
    <main>
      <!-- More divs probably... Prediction page need a lot-->
        <div class="match-header">
            <div class="teams-container">
                <div class="team-home">
                    <img src="" class="team-crest" data-team="{{ match.h.title }}">
                    <h2>{{ match.h.title }}</h2>
                    <div class="team-form">
                        <h4>Recent xG: {{ home_xg|map('float')|map('round', 2)|join(', ') }}</h4>
                    </div>
                </div>
                
                <div class="match-time">
                    {{ match.datetime.split(' ')[1][:5] }}
                </div>

                <div class="team-away">
                    <img src="" class="team-crest" data-team="{{ match.a.title }}">
                    <h2>{{ match.a.title }}</h2>
                    <div class="team-form">
                        <h4>Recent xG: {{ away_xg|map('float')|map('round', 2)|join(', ') }}</h4>
                    </div>
                </div>
            </div>
            
            <div class="match-date">
                {{ match.datetime.split(' ')[0] }}
            </div>
        </div>

        <div class="prediction-section">
            <div class="ai-prediction">
                <h3>AI Prediction</h3>
                <p>{{ ai_prediction.home }} - {{ ai_prediction.away }}</p>
                
                <div class="probabilities">
                    <p>Win: {{ probabilities.home_win }}%</p>
                    <p>Draw: {{ probabilities.draw }}%</p>
                    <p>Loss: {{ probabilities.away_win }}%</p>
                </div>
            </div>

            <div class="user-prediction">
                <h3>Your Prediction</h3>
                
                {% if session.username %}
                    <form id="prediction-form" method="POST" action="{{ url_for('main.prediction', match_id=match.id) }}">
                        {{ form.hidden_tag() }}
                        
                        <div class="score-inputs">
                            <div class="form-field">
                                {{ form.home_score(id="home-score", min=0, max=20, value=user_prediction.home_score if user_prediction else 0) }}
                                {% if form.home_score.errors %}
                                    <div class="error">{{ form.home_score.errors[0] }}</div>
                                {% endif %}
                            </div>
                            <span>-</span>
                            <div class="form-field">
                                {{ form.away_score(id="away-score", min=0, max=20, value=user_prediction.away_score if user_prediction else 0) }}
                                {% if form.away_score.errors %}
                                    <div class="error">{{ form.away_score.errors[0] }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="prediction-odds">
                            <p>Multiplier: <span id="odds-multiplier">1.00</span>x</p>
                            <p>Potential Points:</p>
                            <ul>
                                <li>Exact Score: <span id="exact-points">100</span></li>
                                <li>Correct Result: <span id="result-points">100</span></li>
                            </ul>
                        </div>
                        
                        {{ form.submit(class="submit-prediction") }}
                        
                        {% if user_prediction %}
                            <div class="prediction-status">
                                <p>You have already predicted {{ user_prediction.home_score }} - {{ user_prediction.away_score }}</p>
                            </div>
                        {% endif %}
                    </form>

                    <div class="bets-link">
                        <a href="{{ url_for('main.yourBets') }}" class="view-bets-link">View All Your Bets</a>
                    </div>
                {% else %}
                    <p class="login-prompt">Please <a href="{{ url_for('main.login') }}">login</a> to save your prediction</p>
                {% endif %}
            </div>
            
        </div>
    </main>
    <footer>Footer</footer>
</div>

<!-- data attributes might wanna change base points and home weight-->
<div id="match-data" 
    data-home-expected="{{ home_expected }}"
    data-away-expected="{{ away_expected }}"
    data-base-points="100">
</div>

{% endblock %}